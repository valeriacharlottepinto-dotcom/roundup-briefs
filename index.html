<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Roundup Briefs â€” Women & LGBTQIA+ News</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Inter:wght@400;500;600&display=swap" rel="stylesheet"/>
  <style>
    :root {
      --pride1:#FF0018; --pride2:#FFA52C; --pride3:#FFFF41;
      --pride4:#008018; --pride5:#0000F9; --pride6:#86007D;
      --pink:#E91E8C; --purple:#7B2FBE; --teal:#00BCD4;
      --dark:#0f0f1a; --card:#1a1a2e; --border:#2e2e4a;
      --text:#f0eeff; --muted:#9b9bc4;
    }
    * { box-sizing:border-box; margin:0; padding:0; }
    body { font-family:'Inter',sans-serif; background:var(--dark); color:var(--text); min-height:100vh; }

    /* â”€â”€ Rainbow stripe â”€â”€ */
    .rainbow-bar {
      height:5px;
      background:linear-gradient(90deg,
        var(--pride1) 0%,   var(--pride1) 16.6%,
        var(--pride2) 16.6%,var(--pride2) 33.2%,
        var(--pride3) 33.2%,var(--pride3) 49.8%,
        var(--pride4) 49.8%,var(--pride4) 66.4%,
        var(--pride5) 66.4%,var(--pride5) 83%,
        var(--pride6) 83%,  var(--pride6) 100%);
    }

    /* â”€â”€ Header â”€â”€ */
    header {
      background:linear-gradient(135deg,#0f0f1a 0%,#1a0a2e 50%,#0a1a2e 100%);
      padding:40px 40px 32px; position:relative; overflow:hidden;
    }
    header::before {
      content:''; position:absolute; inset:0;
      background:radial-gradient(ellipse at 70% 50%,rgba(123,47,190,.15) 0%,transparent 60%);
      pointer-events:none;
    }
    .header-inner {
      max-width:1300px; margin:0 auto;
      display:flex; align-items:flex-end; justify-content:space-between;
      flex-wrap:wrap; gap:20px; position:relative;
    }
    header h1 {
      font-family:'Playfair Display',serif;
      font-size:clamp(2.2rem,5vw,3.5rem); font-weight:900;
      background:linear-gradient(135deg,#E91E8C,#7B2FBE,#00BCD4);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
      line-height:1.1;
    }
    header .tagline { font-size:.9rem; color:var(--muted); margin-top:6px; letter-spacing:.3px; }
    #last-updated { font-size:.78rem; color:var(--muted); text-align:right; }

    /* â”€â”€ Category nav tabs â”€â”€ */
    nav { background:#13132a; border-bottom:1px solid var(--border); padding:0 40px; }
    .nav-inner { max-width:1300px; margin:0 auto; display:flex; gap:4px; overflow-x:auto; }
    .tab {
      padding:14px 22px; font-size:.88rem; font-weight:600; cursor:pointer;
      border-bottom:3px solid transparent; color:var(--muted);
      white-space:nowrap; transition:all .2s; user-select:none;
    }
    .tab:hover { color:var(--text); }
    .tab.active                      { color:var(--pink);  border-bottom-color:var(--pink); }
    .tab[data-cat="lgbtqia+"].active { color:var(--teal);  border-bottom-color:var(--teal); }
    .tab[data-cat="women"].active    { color:#FF85C2;       border-bottom-color:#FF85C2; }

    /* â”€â”€ Filter bar â”€â”€ */
    #filter-bar {
      background:#13132a; border-bottom:1px solid var(--border);
      padding:12px 40px; display:flex; flex-direction:column; gap:10px;
    }
    .filter-row {
      max-width:1300px; margin:0 auto; width:100%;
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .filter-label {
      font-size:.72rem; font-weight:600; color:var(--muted);
      text-transform:uppercase; letter-spacing:.6px; white-space:nowrap; min-width:56px;
    }

    /* â”€â”€ Chips â”€â”€ */
    .chip-scroll { display:flex; gap:6px; overflow-x:auto; flex-wrap:wrap; flex:1; }
    .chip-scroll::-webkit-scrollbar { height:3px; }
    .chip-scroll::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
    .chip {
      padding:6px 14px; border-radius:20px; font-size:.78rem; font-weight:600;
      cursor:pointer; border:1px solid var(--border); background:transparent;
      color:var(--muted); white-space:nowrap; transition:all .18s; user-select:none;
    }
    .chip:hover { color:var(--text); border-color:var(--text); }
    .chip.active { color:#fff; border-color:transparent; box-shadow:0 2px 10px rgba(0,0,0,.3); }

    /* â”€â”€ Source chips â€” smaller â”€â”€ */
    .source-chip {
      padding:4px 11px; border-radius:16px; font-size:.72rem; font-weight:600;
      cursor:pointer; border:1px solid var(--border); background:transparent;
      color:var(--muted); white-space:nowrap; transition:all .18s; user-select:none;
    }
    .source-chip:hover { color:var(--text); border-color:var(--text); }
    .source-chip.active { color:#fff; border-color:transparent; }
    .source-chip.lgbtq.active  { background:var(--purple); }
    .source-chip.women.active  { background:var(--pink); }
    .source-chip.general.active{ background:#3F51B5; }
    .source-chip.all.active    { background:#444; }

    /* Source row label + expand toggle */
    .source-row-inner { display:flex; align-items:center; gap:8px; flex:1; flex-wrap:wrap; }

    /* â”€â”€ Date range â”€â”€ */
    .date-range {
      display:flex; align-items:center; gap:8px; flex-wrap:wrap;
      padding:4px 12px; border:1px solid var(--border); border-radius:24px; background:var(--card);
    }
    .date-range-label { font-size:.78rem; color:var(--muted); white-space:nowrap; }
    input[type="date"] {
      padding:4px 8px; border:none; border-radius:6px;
      background:transparent; color:var(--text); font-size:.8rem;
      font-family:'Inter',sans-serif; cursor:pointer; outline:none;
    }
    input[type="date"]::-webkit-calendar-picker-indicator { filter:invert(.6); cursor:pointer; }
    input[type="date"].has-value { color:var(--pink); }
    .date-sep { color:var(--muted); font-size:.78rem; }
    .clear-dates-btn {
      background:none; border:none; cursor:pointer; color:var(--muted);
      font-size:.8rem; padding:2px 4px; transition:color .15s;
    }
    .clear-dates-btn:hover { color:var(--pink); }

    /* â”€â”€ Search â”€â”€ */
    .search-wrap { position:relative; }
    .search-icon { position:absolute; left:13px; top:50%; transform:translateY(-50%); opacity:.4; }
    #search-box {
      padding:8px 16px 8px 38px; border:1px solid var(--border); border-radius:24px;
      font-size:.85rem; width:240px; background:var(--card); color:var(--text);
      transition:border-color .2s;
    }
    #search-box:focus { outline:none; border-color:var(--purple); }
    #article-count { margin-left:auto; font-size:.78rem; color:var(--muted); }

    /* â”€â”€ Main grid â”€â”€ */
    .page { max-width:1300px; margin:0 auto; padding:32px 40px; }
    #articles-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:20px; }

    /* â”€â”€ Card â”€â”€ */
    .card {
      background:var(--card); border:1px solid var(--border); border-radius:12px;
      display:flex; flex-direction:column;
      transition:transform .15s,border-color .15s,box-shadow .15s; overflow:hidden;
    }
    .card:hover { transform:translateY(-4px); border-color:var(--pink); box-shadow:0 8px 30px rgba(233,30,140,.15); }
    .card-accent { height:3px; }
    .card-body { padding:18px; flex:1; }
    .badges { display:flex; gap:6px; flex-wrap:wrap; margin-bottom:10px; }
    .badge { font-size:.66rem; font-weight:700; letter-spacing:.4px; text-transform:uppercase; padding:3px 8px; border-radius:10px; }
    .badge-source { background:rgba(255,255,255,.08); color:var(--muted); }
    .badge-topic  { border:1px solid; }
    .card h2 { font-size:.96rem; font-weight:600; line-height:1.45; margin-bottom:8px; color:var(--text); }
    .card p  { font-size:.82rem; color:var(--muted); line-height:1.6;
               display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }
    .card-footer {
      padding:12px 18px; border-top:1px solid var(--border);
      display:flex; justify-content:space-between; align-items:center;
    }
    .date { font-size:.72rem; color:var(--muted); }
    .read-btn {
      font-size:.78rem; font-weight:600; text-decoration:none; color:var(--pink);
      padding:5px 14px; border:1px solid var(--pink); border-radius:14px; transition:all .15s;
    }
    .read-btn:hover { background:var(--pink); color:#fff; }
    .accent-lgbtq { background:linear-gradient(90deg,var(--teal),var(--purple)); }
    .accent-women { background:linear-gradient(90deg,var(--pink),var(--pride6)); }
    .accent-news  { background:linear-gradient(90deg,var(--pride5),var(--teal)); }

    /* â”€â”€ Stats bar â”€â”€ */
    #stats-bar { display:flex; gap:20px; margin-bottom:28px; flex-wrap:wrap; }
    .stat-pill { background:var(--card); border:1px solid var(--border); border-radius:10px; padding:12px 20px; text-align:center; }
    .stat-pill .num { font-size:1.5rem; font-weight:700; }
    .stat-pill .lbl { font-size:.72rem; color:var(--muted); margin-top:2px; }
    .stat-pill.pink  .num { color:var(--pink); }
    .stat-pill.teal  .num { color:var(--teal); }
    .stat-pill.white .num { color:var(--text); }

    /* â”€â”€ Loading / Empty â”€â”€ */
    #status { text-align:center; padding:100px 20px; color:var(--muted); }
    .spinner { width:44px; height:44px; border:3px solid var(--border); border-top-color:var(--pink);
               border-radius:50%; animation:spin .8s linear infinite; margin:0 auto 20px; }
    @keyframes spin { to { transform:rotate(360deg); } }

    @media (max-width:640px) {
      header, nav, #filter-bar, .page { padding-left:16px; padding-right:16px; }
      #articles-grid { grid-template-columns:1fr; }
      #search-box { width:100%; }
    }
  </style>
</head>
<body>

<div class="rainbow-bar"></div>

<header>
  <div class="header-inner">
    <div>
      <h1>Roundup Briefs</h1>
      <p class="tagline">Browse your news on your terms.</p>
    </div>
    <div id="last-updated">Loadingâ€¦</div>
  </div>
</header>

<nav>
  <div class="nav-inner">
    <div class="tab active" data-cat=""         onclick="setCategory('')">âœ¨ All</div>
    <div class="tab"        data-cat="lgbtqia+" onclick="setCategory('lgbtqia+')">ğŸ³ï¸â€ğŸŒˆ LGBTQIA+</div>
    <div class="tab"        data-cat="women"    onclick="setCategory('women')">â™€ Women & Feminism</div>
  </div>
</nav>

<div id="filter-bar">

  <!-- Row 1: Topics -->
  <div class="filter-row">
    <span class="filter-label">Topics</span>
    <div class="chip-scroll" id="topic-chips"></div>
  </div>

  <!-- Row 2: Time â€” only Today + custom calendar -->
  <div class="filter-row">
    <span class="filter-label">Time</span>
    <div class="chip-scroll" style="flex:0;flex-shrink:0;">
      <div class="chip" id="chip-today" onclick="toggleToday()">Today</div>
    </div>
    <div class="date-range">
      <span class="date-range-label">ğŸ“… Custom</span>
      <input type="date" id="date-from" onchange="onDateChange()"/>
      <span class="date-sep">â€”</span>
      <input type="date" id="date-to" onchange="onDateChange()"/>
      <button class="clear-dates-btn" onclick="clearDates()" title="Clear dates">âœ•</button>
    </div>
  </div>

  <!-- Row 3: Sources (all sources as multi-select chips) -->
  <div class="filter-row">
    <span class="filter-label">Sources</span>
    <div class="chip-scroll" id="source-chips"></div>
  </div>

  <!-- Row 4: Search + count -->
  <div class="filter-row">
    <div class="search-wrap">
      <span class="search-icon">ğŸ”</span>
      <input id="search-box" type="text" placeholder="Search headlinesâ€¦" oninput="debouncedRender()"/>
    </div>
    <span id="article-count"></span>
  </div>

</div>

<div id="status">
  <div class="spinner"></div>
  <p>Fetching your newsâ€¦</p>
</div>

<div class="page" id="main-page" style="display:none;">
  <div id="stats-bar"></div>
  <div id="articles-grid"></div>
</div>

<script>
  // â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let allArticles    = [];
  let activeTopics   = new Set(['All']);
  let activeSources  = new Set(['All']);
  let todayActive    = false;
  let activeCategory = '';
  let debounceTimer  = null;

  // â”€â”€ Topic metadata â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const TOPIC_META = [
    { name:'All',                   icon:'âœ¨', color:'#E91E8C' },
    { name:'Reproductive Rights',   icon:'ğŸ©º', color:'#E91E8C' },
    { name:'Gender Pay Gap',        icon:'ğŸ’°', color:'#FFA52C' },
    { name:'LGBTQIA+',              icon:'ğŸ³ï¸â€ğŸŒˆ', color:'#7B2FBE' },
    { name:'Immigration',           icon:'ğŸŒ', color:'#00BCD4' },
    { name:'Human Rights',          icon:'âš–ï¸',  color:'#FF0018' },
    { name:'Health & Medicine',     icon:'ğŸ¥', color:'#4CAF50' },
    { name:'Law & Policy',          icon:'ğŸ“œ', color:'#9C27B0' },
    { name:'Politics & Government', icon:'ğŸ›ï¸', color:'#3F51B5' },
    { name:'Culture & Media',       icon:'ğŸ­', color:'#FF9800' },
    { name:'Sports',                icon:'âš½', color:'#008018' },
    { name:'Violence & Safety',     icon:'ğŸ›¡ï¸', color:'#F44336' },
    { name:'Workplace & Economics', icon:'ğŸ’¼', color:'#607D8B' },
  ];

  // â”€â”€ All sources â€” hardcoded so they're always visible â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const ALL_SOURCES = [
    // LGBTQIA+
    { name:'Gay Times',           type:'lgbtq' },
    { name:'PinkNews',            type:'lgbtq' },
    { name:'Out Magazine',        type:'lgbtq' },
    { name:'LGBTQ Nation',        type:'lgbtq' },
    { name:'Advocate',            type:'lgbtq' },
    { name:'Autostraddle',        type:'lgbtq' },
    { name:'Them',                type:'lgbtq' },
    { name:'Queerty',             type:'lgbtq' },
    { name:'Xtra Magazine',       type:'lgbtq' },
    // Women & Feminist
    { name:'The Guardian Women',  type:'women' },
    { name:'Ms. Magazine',        type:'women' },
    { name:'Feministing',         type:'women' },
    { name:'Jezebel',             type:'women' },
    { name:'Refinery29 Feminism', type:'women' },
    { name:'The Funambulist',     type:'women' },
    // General / World News
    { name:'BBC News',            type:'general' },
    { name:'BBC News World',      type:'general' },
    { name:'The Guardian',        type:'general' },
    { name:'Reuters',             type:'general' },
    { name:'Reuters World',       type:'general' },
    { name:'Al Jazeera',          type:'general' },
    { name:'NPR News',            type:'general' },
    { name:'The Independent',     type:'general' },
    { name:'HuffPost',            type:'general' },
    { name:'New York Times',      type:'general' },
    { name:'Associated Press',    type:'general' },
    { name:'CNN World',           type:'general' },
    { name:'Washington Post',     type:'general' },
    { name:'Financial Times',     type:'general' },
    { name:'CBC News World',      type:'general' },
    { name:'ABC News',            type:'general' },
    { name:'SBS News World',      type:'general' },
    { name:'Le Monde',            type:'general' },
    { name:'IPS News Agency',     type:'general' },
    { name:'The Conversation',    type:'general' },
    { name:'Global Voices',       type:'general' },
    { name:'Fair Observer',       type:'general' },
  ];

  const LGBTQ_SOURCE_NAMES = new Set(ALL_SOURCES.filter(s=>s.type==='lgbtq').map(s=>s.name));
  const WOMEN_SOURCE_NAMES = new Set(ALL_SOURCES.filter(s=>s.type==='women').map(s=>s.name));

  // â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function accentClass(source) {
    if (LGBTQ_SOURCE_NAMES.has(source)) return 'accent-lgbtq';
    if (WOMEN_SOURCE_NAMES.has(source)) return 'accent-women';
    return 'accent-news';
  }
  function formatDate(iso) {
    if (!iso) return '';
    try { return new Date(iso).toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'}); }
    catch { return ''; }
  }
  function toDateStr(iso) { return iso ? iso.slice(0,10) : ''; }

  // â”€â”€ Build topic chips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function initTopicChips() {
    const tc = document.getElementById('topic-chips');
    TOPIC_META.forEach(t => {
      const el = document.createElement('div');
      el.className = 'chip' + (t.name==='All' ? ' active' : '');
      el.textContent = `${t.icon} ${t.name}`;
      el.dataset.topic = t.name;
      if (t.name==='All') el.style.cssText = `background:${t.color};border-color:${t.color};color:#fff;`;
      el.onclick = () => toggleTopic(t.name, el, t.color);
      tc.appendChild(el);
    });
  }

  // â”€â”€ Build source chips â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function initSourceChips() {
    const sc = document.getElementById('source-chips');

    // "All Sources" chip first
    const allEl = document.createElement('div');
    allEl.className = 'source-chip all active';
    allEl.textContent = 'All Sources';
    allEl.dataset.source = 'All';
    allEl.style.cssText = 'background:#444;border-color:#444;color:#fff;';
    allEl.onclick = () => toggleSource('All', allEl);
    sc.appendChild(allEl);

    ALL_SOURCES.forEach(s => {
      const el = document.createElement('div');
      el.className = `source-chip ${s.type}`;
      el.textContent = s.name;
      el.dataset.source = s.name;
      el.onclick = () => toggleSource(s.name, el);
      sc.appendChild(el);
    });
  }

  // â”€â”€ Topic toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function toggleTopic(name, el, color) {
    const chips = document.querySelectorAll('#topic-chips .chip');
    if (name === 'All') {
      activeTopics = new Set(['All']);
      chips.forEach(c => {
        const meta = TOPIC_META.find(t => t.name===c.dataset.topic);
        c.classList.remove('active'); c.style.cssText='';
        if (c.dataset.topic==='All' && meta) {
          c.classList.add('active');
          c.style.cssText = `background:${meta.color};border-color:${meta.color};color:#fff;`;
        }
      });
    } else {
      activeTopics.delete('All');
      const allChip = document.querySelector('#topic-chips .chip[data-topic="All"]');
      if (allChip) { allChip.classList.remove('active'); allChip.style.cssText=''; }
      if (activeTopics.has(name)) {
        activeTopics.delete(name); el.classList.remove('active'); el.style.cssText='';
        if (activeTopics.size===0) toggleTopic('All', allChip, '#E91E8C');
      } else {
        activeTopics.add(name); el.classList.add('active');
        el.style.cssText = `background:${color};border-color:${color};color:#fff;`;
      }
    }
    renderArticles();
  }

  // â”€â”€ Source toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function toggleSource(name, el) {
    const chips = document.querySelectorAll('#source-chips .source-chip');
    const allChip = document.querySelector('#source-chips .source-chip[data-source="All"]');

    if (name === 'All') {
      activeSources = new Set(['All']);
      chips.forEach(c => { c.classList.remove('active'); c.style.cssText=''; });
      allChip.classList.add('active');
      allChip.style.cssText = 'background:#444;border-color:#444;color:#fff;';
    } else {
      // Deselect "All Sources"
      activeSources.delete('All');
      if (allChip) { allChip.classList.remove('active'); allChip.style.cssText=''; }

      if (activeSources.has(name)) {
        activeSources.delete(name); el.classList.remove('active');
        if (activeSources.size===0) toggleSource('All', allChip);
      } else {
        activeSources.add(name); el.classList.add('active');
      }
    }
    renderArticles();
  }

  // â”€â”€ Today toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function toggleToday() {
    todayActive = !todayActive;
    const chip = document.getElementById('chip-today');
    if (todayActive) {
      chip.classList.add('active');
      chip.style.cssText = 'background:#7B2FBE;border-color:#7B2FBE;color:#fff;';
      // Clear custom dates
      document.getElementById('date-from').value='';
      document.getElementById('date-to').value='';
      document.getElementById('date-from').classList.remove('has-value');
      document.getElementById('date-to').classList.remove('has-value');
    } else {
      chip.classList.remove('active'); chip.style.cssText='';
    }
    renderArticles();
  }

  // â”€â”€ Custom date range â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function onDateChange() {
    const fromVal = document.getElementById('date-from').value;
    const toVal   = document.getElementById('date-to').value;
    document.getElementById('date-from').classList.toggle('has-value', !!fromVal);
    document.getElementById('date-to').classList.toggle('has-value', !!toVal);
    if (fromVal || toVal) {
      // Deselect Today chip when custom dates are used
      todayActive = false;
      const chip = document.getElementById('chip-today');
      chip.classList.remove('active'); chip.style.cssText='';
    }
    renderArticles();
  }

  function clearDates() {
    document.getElementById('date-from').value='';
    document.getElementById('date-to').value='';
    document.getElementById('date-from').classList.remove('has-value');
    document.getElementById('date-to').classList.remove('has-value');
    renderArticles();
  }

  // â”€â”€ Category tabs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setCategory(cat) {
    activeCategory = cat;
    document.querySelectorAll('.tab').forEach(t =>
      t.classList.toggle('active', t.dataset.cat===cat)
    );
    renderArticles();
  }

  // â”€â”€ Filter + render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderArticles() {
    const query    = document.getElementById('search-box').value.toLowerCase();
    const dateFrom = document.getElementById('date-from').value;
    const dateTo   = document.getElementById('date-to').value;
    const grid     = document.getElementById('articles-grid');

    let filtered = allArticles.filter(a => {
      // Category tab
      if (activeCategory) {
        const tags = a.tags || '';
        if (!tags.includes(activeCategory) && a.category !== activeCategory) return false;
      }
      // Topics (multi-select, OR logic)
      if (!activeTopics.has('All')) {
        const aTopics = (a.topics || '').toLowerCase();
        if (![...activeTopics].some(t => aTopics.includes(t.toLowerCase()))) return false;
      }
      // Sources (multi-select, OR logic)
      if (!activeSources.has('All')) {
        if (!activeSources.has(a.source)) return false;
      }
      // Today filter
      if (todayActive) {
        const scraped = new Date(a.scraped_at);
        const start   = new Date(); start.setHours(0,0,0,0);
        if (scraped < start) return false;
      }
      // Custom date range
      if (dateFrom && toDateStr(a.scraped_at) < dateFrom) return false;
      if (dateTo   && toDateStr(a.scraped_at) > dateTo)   return false;
      // Search
      if (query) {
        const inTitle   = (a.title   || '').toLowerCase().includes(query);
        const inSummary = (a.summary || '').toLowerCase().includes(query);
        if (!inTitle && !inSummary) return false;
      }
      return true;
    });

    document.getElementById('article-count').textContent =
      `${filtered.length} article${filtered.length!==1?'s':''}`;

    if (filtered.length===0) {
      grid.innerHTML = `<p style="color:var(--muted);padding:60px 0;grid-column:1/-1;text-align:center;">No articles match your filters.</p>`;
      return;
    }

    grid.innerHTML = filtered.map(a => {
      const topicBadges = (a.topics||'').split(',').map(t=>t.trim()).filter(Boolean).map(t => {
        const meta = TOPIC_META.find(m=>m.name===t);
        if (!meta) return '';
        return `<span class="badge badge-topic" style="background:${meta.color}22;color:${meta.color};border-color:${meta.color}44;">${meta.icon} ${t}</span>`;
      }).join('');
      return `
        <div class="card">
          <div class="card-accent ${accentClass(a.source)}"></div>
          <div class="card-body">
            <div class="badges">
              <span class="badge badge-source">${a.source}</span>
              ${topicBadges}
            </div>
            <h2>${a.title}</h2>
            <p>${a.summary||'Click to read the full article.'}</p>
          </div>
          <div class="card-footer">
            <span class="date">${formatDate(a.scraped_at)}</span>
            <a class="read-btn" href="${a.link}" target="_blank" rel="noopener">Read â†’</a>
          </div>
        </div>`;
    }).join('');
  }

  function debouncedRender() {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(renderArticles, 300);
  }

  // â”€â”€ Load data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadStats() {
    try {
      const data = await fetch('/api/stats').then(r=>r.json());
      document.getElementById('stats-bar').innerHTML = `
        <div class="stat-pill white"><div class="num">${data.total}</div><div class="lbl">Total Articles</div></div>
        <div class="stat-pill teal"><div class="num">${data.lgbtqia_plus}</div><div class="lbl">LGBTQIA+</div></div>
        <div class="stat-pill pink"><div class="num">${data.women}</div><div class="lbl">Women & Feminism</div></div>`;
      if (data.last_scraped)
        document.getElementById('last-updated').textContent = 'Last updated: '+formatDate(data.last_scraped);
    } catch {}
  }

  async function loadArticles() {
    try {
      allArticles = await fetch('/api/articles?limit=500').then(r=>r.json());
      document.getElementById('status').style.display = 'none';
      document.getElementById('main-page').style.display = 'block';
      await loadStats();
      renderArticles();
    } catch {
      document.getElementById('status').innerHTML =
        `<p style="color:var(--pink);">âŒ Could not load articles.<br><small>Make sure the server is running.</small></p>`;
    }
  }

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  initTopicChips();
  initSourceChips();
  loadArticles();
</script>
</body>
</html>
